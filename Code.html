<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project Code Editor</title>
<link rel="stylesheet" href="style.css">
<style>
body { margin:0; font-family:sans-serif; background:#111; color:white; display:flex; flex-direction:column; height:100vh; }
#topBar { display:flex; justify-content:space-between; padding:10px; background:#222; }
button { background:#2979ff; color:white; border:none; padding:6px 12px; border-radius:5px; cursor:pointer; }
button:hover { background:#1e6cd2; }
#main { display:flex; flex-direction:column; flex-grow:1; }
#previewContainer { flex:1; background:#333; }
#preview { width:100%; height:100%; border:none; }
#editorContainer { flex:1; display:flex; flex-direction:column; }
#editor { flex:1; width:100%; background:#222; color:white; border:none; padding:10px; font-family:monospace; resize:none; }
#editor:focus { outline:none; }
#bottomBar { display:flex; justify-content:flex-end; padding:5px 10px; background:#222; font-size:12px; color:#aaa; }
</style>
</head>
<body>

<!-- Top Bar -->
<div id="topBar">
  <button onclick="copyCode()">Copy Code</button>
  <button onclick="location.href='index.html'">Home</button>
</div>

<!-- Main Section -->
<div id="main">
  <div id="previewContainer">
    <iframe id="preview"></iframe>
  </div>
  <div id="editorContainer">
    <textarea id="editor"></textarea>
  </div>
</div>

<!-- Bottom Bar -->
<div id="bottomBar" id="footer">Saved Time: -- @minabasem</div>

<script>
// جلب المشروع من localStorage
let project = JSON.parse(localStorage.getItem("project") || '{"nodes":[],"files":{}}');

// تحديث Preview بناءً على مشروعك
function updatePreview(){
  let html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Preview</title></head><body>`;
  project.nodes.forEach(n=>{
    if(n.type==="div") html+=`<div id="node_${n.id}" style="position:absolute;left:${n.x}px;top:${n.y}px;width:${n.sx*100}px;height:${n.sy*100}px;background:${n.color}"></div>`;
    if(n.type==="button") html+=`<button id="node_${n.id}" style="position:absolute;left:${n.x}px;top:${n.y}px;width:${n.sx*100}px;height:${n.sy*40}px;background:${n.color};color:white;font-size:${n.fontSize}px">${n.text}</button>`;
  });
  html += "</body></html>";
  document.getElementById("preview").srcdoc = html;
  document.getElementById("editor").value = html;
}

// عند كتابة المستخدم في المحرر، يتم تحديث Preview مباشرة
document.getElementById("editor").addEventListener("input", function(){
  document.getElementById("preview").srcdoc = this.value;
});

// نسخ الكود
function copyCode(){
  const editor = document.getElementById("editor");
  editor.select();
  document.execCommand("copy");
  alert("Code copied to clipboard!");
}

// Auto Save كل 5 ثواني
setInterval(()=>{
  localStorage.setItem("project", JSON.stringify(project));
  updateFooterTime();
},5000);

// تحديث Footer بالوقت
function updateFooterTime(){
  const now = new Date();
  document.getElementById("bottomBar").innerText=`Saved Time: ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()} @minabasem`;
}

// تشغيل أول مرة
updatePreview();
updateFooterTime();
</script>
</body>
</html>